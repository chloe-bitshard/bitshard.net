<!DOCTYPE html>
<html lang="en-us">
<head>
  <meta name="generator" content="HTML Tidy for HTML5 for Linux version 5.6.0">
  <meta charset="utf-8">
  <link rel="stylesheet" href="/theme/style/head.css" />
  <script src="/theme/script/head.js"></script>
  
  <meta name="google-site-verification" content="TODO">
  <link rel="preconnect" href="https://www.googletagmanager.com">

  <meta name="title" content="Essays">
  <meta name="citation_title" content="Essays">
  <meta name="og:title" content="Essays">
  <meta name="twitter:title" content="Essays">

  <meta name="generator" content="https://github.com/gwern/gwern.net/">

  <meta name="creator" content="bitshard.net">
  <meta name="author" content="Chloe Bitshard">
  <meta name="citation_author" content="Chloe Bitshard">
  <meta name="contact" content="https://bitshard.net/me#contact">

  <link rel="index" title="Bitshard.net homepage" href="https://bitshard.net/index">
  
  <link href="https://bitshard.substack.com/feed" type="application/rss+xml" rel="alternate" title="ATOM/RSS feed of Gwern.net newsletters with additions and links.">
  
  <meta name="og:site" content="bitshard.net">
  <meta name="og:type" content="article">

  <meta name="description" content="Personal website of Chloe Bitshard. This index page is a categorized list of Bitshard.net pages.">
  <meta name="og:description" content="Personal website of Chloe Bitshard. This index page is a categorized list of Bitshard.net pages.">
  
  <meta property="og:image" content="/theme/img/profile.png">

  <meta property="og:image:alt" content="Default thumbnail text: Chloe Bitshard Profile Picture.  Stylized, glitchy profile of a woman with brown hair with a city in the background.">
  <meta property="og:image:height" content="512">
  <meta property="og:image:width" content="512">

  <meta name="keywords" content="meta">
  
  <meta name="dc.date.issued" content="2023-07-01">
  <meta name="citation_publication_date" content="2023-07-01">

  <meta name="dcterms.modified" content="2023-07-06"> <!-- TODO: Automatically Update -->
  <link rel="schema.dcterms" href="https://www.dublincore.org/specifications/dublin-core/dcmi-terms/">
  <meta name="dcterms.rights" content="CC BY-NC-SA 4.0">
  <meta name="dc.rights" content="https://creativecommons.org/licenses/by-nc-sa/4.0/">

  <link rel="canonical" href="https://bitshard.net/index">
  <meta name="citation_fulltext_html_url" content="https://bitshard.net/index">
  <meta name="og:url" content="https://bitshard.net/index">

  <!-- <meta name="page-body-classes" content="index drop-caps-de-zs"> --> <!-- TODO: Figure out once done -->

  <meta name="page-source" content="https://bitshard.net/index.md">
  
  <meta name="citation_fulltext_world_readable" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="color-scheme" content="light">
  <title>Essays Â· Bitshard.net</title>

  <link rel="icon" type="image/png" href="/theme/img/profile.png"> <!-- TODO -->
  <link rel="apple-touch-icon" type="image/png" href="/theme/img/profile.png"> <!-- TODO -->
</head><!-- Skip fancy css like drop-caps on index pages -->

<body class="index indented justified">
  <main>
    <nav id="sidebar">
      <div class="sidebar-links">
        <ul>
            <li>
               <a class="icon-not index title" href="/index.html" title="Homepage: categorized list of articles index" rel="author">Bitshard</a>
            </li>
            <li>
                <a class="icon-not site link-page link-annotated" href="/about" title="Site ideals, source, content, traffic, examples, license" rel="author">Site</a>
            </li>
            <li>
                <a class="icon-not me link-page link-annotated" href="/me" title="Who am I online, what have I done, what am I like? Contact information; sites I use; things I've worked on" rel="author">Me</a>
            </li>
            <li>
                <a class="icon-not mail link-page" href="https://bitshard.substack.com" title="Monthly mailing list archives" rel="me">News</a>
            </li>
        </ul>
      </div>
    </nav>
    
    <header>
    <h1>
      Secure Use of GPT APIs via Metadata Analysis
    </h1>
    </header>
    <article>
<div id="markdownBody" class="markdownBody">
    <div class="abstract">
        <blockquote class="summary"><p>LLM usage has been criticized on a number of fronts; one of which is that by needing to use an external API, like OpenAI's, you are unable to use GPT-4 on secret information.  I propose that GPT-4 is capable of securely answering difficult questions about confidential data without exposing the data to OpenAI.</p></blockquote>
    </div>
    <p class="intro-paragraph drop-cap-de-zs">
One of the main roadblocks to GPT-4 adoption in production has been the need to ensure that secure data remains secure.  One area where LLM responses can be extremely useful is when answering questions about large sets of data.  In this article, I will discuss a method for generating reports on confidential data using LLMs without exposing the data to the LLM.</p>

<h2>The Problem</h2>
<p>Imagine you have a complex database, built up over many years.  There are a large number of tables, and the way they interconnect requires a bit of thought.</p>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="n">id</span><span class="w"> </span><span class="nb">INT</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">  </span><span class="n">name</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
<span class="w">  </span><span class="n">email</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
<span class="w">  </span><span class="n">password</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
<span class="w">  </span><span class="n">created_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="p">,</span>
<span class="w">  </span><span class="n">updated_at</span><span class="w"> </span><span class="k">TIMESTAMP</span>
<span class="p">);</span>

<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">posts</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="n">id</span><span class="w"> </span><span class="nb">INT</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">  </span><span class="n">user_id</span><span class="w"> </span><span class="nb">INT</span><span class="p">,</span>
<span class="w">  </span><span class="n">title</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
<span class="w">  </span><span class="n">body</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">  </span><span class="n">created_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="p">,</span>
<span class="w">  </span><span class="n">updated_at</span><span class="w"> </span><span class="k">TIMESTAMP</span>
<span class="p">);</span>

<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">comments</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="n">id</span><span class="w"> </span><span class="nb">INT</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">  </span><span class="n">user_id</span><span class="w"> </span><span class="nb">INT</span><span class="p">,</span>
<span class="w">  </span><span class="n">post_id</span><span class="w"> </span><span class="nb">INT</span><span class="p">,</span>
<span class="w">  </span><span class="n">body</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">  </span><span class="n">created_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="p">,</span>
<span class="w">  </span><span class="n">updated_at</span><span class="w"> </span><span class="k">TIMESTAMP</span>
<span class="p">);</span>

<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">likes</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="n">id</span><span class="w"> </span><span class="nb">INT</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">  </span><span class="n">user_id</span><span class="w"> </span><span class="nb">INT</span><span class="p">,</span>
<span class="w">  </span><span class="n">post_id</span><span class="w"> </span><span class="nb">INT</span><span class="p">,</span>
<span class="w">  </span><span class="n">created_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="p">,</span>
<span class="w">  </span><span class="n">updated_at</span><span class="w"> </span><span class="k">TIMESTAMP</span>
<span class="p">);</span>

<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">follows</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="n">id</span><span class="w"> </span><span class="nb">INT</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">  </span><span class="n">user_id</span><span class="w"> </span><span class="nb">INT</span><span class="p">,</span>
<span class="w">  </span><span class="n">followed_user_id</span><span class="w"> </span><span class="nb">INT</span><span class="p">,</span>
<span class="w">  </span><span class="n">created_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="p">,</span>
<span class="w">  </span><span class="n">updated_at</span><span class="w"> </span><span class="k">TIMESTAMP</span>
<span class="p">);</span>

<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">tags</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="n">id</span><span class="w"> </span><span class="nb">INT</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">  </span><span class="n">name</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
<span class="w">  </span><span class="n">created_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="p">,</span>
<span class="w">  </span><span class="n">updated_at</span><span class="w"> </span><span class="k">TIMESTAMP</span>
<span class="p">);</span>

<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">subscriptions</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="n">id</span><span class="w"> </span><span class="nb">INT</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">  </span><span class="n">user_id</span><span class="w"> </span><span class="nb">INT</span><span class="p">,</span>
<span class="w">  </span><span class="n">tag_id</span><span class="w"> </span><span class="nb">INT</span><span class="p">,</span>
<span class="w">  </span><span class="n">created_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="p">,</span>
<span class="w">  </span><span class="n">updated_at</span><span class="w"> </span><span class="k">TIMESTAMP</span>
<span class="p">);</span>

<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">referrals</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="n">id</span><span class="w"> </span><span class="nb">INT</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">  </span><span class="n">user_id</span><span class="w"> </span><span class="nb">INT</span><span class="p">,</span>
<span class="w">  </span><span class="n">referred_user_id</span><span class="w"> </span><span class="nb">INT</span><span class="p">,</span>
<span class="w">  </span><span class="n">created_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="p">,</span>
<span class="w">  </span><span class="n">updated_at</span><span class="w"> </span><span class="k">TIMESTAMP</span>
<span class="p">);</span>

<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">notifications</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="n">id</span><span class="w"> </span><span class="nb">INT</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">  </span><span class="n">user_id</span><span class="w"> </span><span class="nb">INT</span><span class="p">,</span>
<span class="w">  </span><span class="n">message</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">  </span><span class="n">created_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="p">,</span>
<span class="w">  </span><span class="n">updated_at</span><span class="w"> </span><span class="k">TIMESTAMP</span>
<span class="p">);</span>

<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">logins</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="n">id</span><span class="w"> </span><span class="nb">INT</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">  </span><span class="n">user_id</span><span class="w"> </span><span class="nb">INT</span><span class="p">,</span>
<span class="w">  </span><span class="n">ip_address</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
<span class="w">  </span><span class="n">created_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="p">,</span>
<span class="w">  </span><span class="n">updated_at</span><span class="w"> </span><span class="k">TIMESTAMP</span>
<span class="p">);</span>

<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">locations</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="n">id</span><span class="w"> </span><span class="nb">INT</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">  </span><span class="n">user_id</span><span class="w"> </span><span class="nb">INT</span><span class="p">,</span>
<span class="w">  </span><span class="n">latitude</span><span class="w"> </span><span class="nb">DECIMAL</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span>
<span class="w">  </span><span class="n">longitude</span><span class="w"> </span><span class="nb">DECIMAL</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span>
<span class="w">  </span><span class="n">created_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="p">,</span>
<span class="w">  </span><span class="n">updated_at</span><span class="w"> </span><span class="k">TIMESTAMP</span>
<span class="p">);</span>
</code></pre></div>

<p>This is a fairly simple database, but it's not immediately obvious how the tables are connected.  If you wanted to know how many users had liked a post, you would need to write a query like this:</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">likes</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">post_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
</code></pre></div>

<p>If you wanted to know how many users had liked a post, and how many users had commented on a post, you would need to write a query like this:</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">likes</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">post_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="k">SELECT</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">comments</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">post_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
</code></pre></div>

<p>If you wanted to know where the 10 users who have referred the most users who logged in within the past 24 hours are located, you would need to write a query like this:</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">locations</span><span class="p">.</span><span class="n">latitude</span><span class="p">,</span><span class="w"> </span><span class="n">locations</span><span class="p">.</span><span class="n">longitude</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">locations</span>
<span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">logins</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">logins</span><span class="p">.</span><span class="n">user_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">locations</span><span class="p">.</span><span class="n">user_id</span>
<span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">referrals</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">referrals</span><span class="p">.</span><span class="n">user_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">logins</span><span class="p">.</span><span class="n">user_id</span>
<span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">users</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">referrals</span><span class="p">.</span><span class="n">referred_user_id</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">logins</span><span class="p">.</span><span class="n">created_at</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">NOW</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nb">INTERVAL</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">DAY</span>
<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">locations</span><span class="p">.</span><span class="n">latitude</span><span class="p">,</span><span class="w"> </span><span class="n">locations</span><span class="p">.</span><span class="n">longitude</span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">DESC</span>
<span class="k">LIMIT</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span>
</code></pre></div>

<p>The first few were pretty straightforward, but the last one was a bit more complicated.  Frequently, answering these kinds of questions requires a non-trivial amount of SQL knowledge.  If you're not a SQL expert, you might not be able to answer these questions at all.</p>
<h2>Enabling LLMs to Answer Questions About Confidential Data</h2>
<p>LLMs are capable of answering questions about confidential data without exposing the data to OpenAI.  This is accomplished by using metadata analysis to determine the answer to the question.</p>
<p>You can ask:</p>
<blockquote>

I have a database with the following structure:


<div class="highlight"><pre><span></span><code>CREATE TABLE users (
  id INT PRIMARY KEY,
  name VARCHAR(255),
  email VARCHAR(255),
  password VARCHAR(255),
  created_at TIMESTAMP,
  updated_at TIMESTAMP
);

...

CREATE TABLE locations (
  id INT PRIMARY KEY,
  user_id INT,
  latitude DECIMAL(9,6),
  longitude DECIMAL(9,6),
  created_at TIMESTAMP,
  updated_at TIMESTAMP
);
</code></pre></div>



Where are the 10 users who have referred the most users who logged in within the past 24 hours are located?

Return the response in a json format with a key 'SQL' and a value of an SQL query to provide that information.
</blockquote>

<p>To which ChatGPT returns:</p>
<blockquote>
The SQL query to find this information will need to join several tables and aggregate the data in a certain way. Here is the JSON response:



<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">"SQL"</span><span class="p">:</span><span class="w"> </span><span class="s2">"</span>
<span class="s2">    WITH referred_users AS (</span>
<span class="s2">      SELECT r.user_id, COUNT(*) AS referred_count</span>
<span class="s2">      FROM referrals AS r</span>
<span class="s2">      JOIN logins AS l ON r.referred_user_id = l.user_id</span>
<span class="s2">      WHERE l.created_at &gt; NOW() - INTERVAL '24 hours'</span>
<span class="s2">      GROUP BY r.user_id</span>
<span class="s2">    ), </span>
<span class="s2">    ranked_users AS (</span>
<span class="s2">      SELECT *, RANK() OVER (ORDER BY referred_count DESC) AS rank</span>
<span class="s2">      FROM referred_users</span>
<span class="s2">    ),</span>
<span class="s2">    user_locations AS (</span>
<span class="s2">      SELECT </span>
<span class="s2">        u.name, </span>
<span class="s2">        u.email, </span>
<span class="s2">        loc.latitude, </span>
<span class="s2">        loc.longitude</span>
<span class="s2">      FROM users AS u</span>
<span class="s2">      JOIN locations AS loc ON u.id = loc.user_id</span>
<span class="s2">    )</span>
<span class="s2">    SELECT </span>
<span class="s2">      u.name,</span>
<span class="s2">      u.email,</span>
<span class="s2">      u.latitude,</span>
<span class="s2">      u.longitude</span>
<span class="s2">    FROM ranked_users AS r</span>
<span class="s2">    JOIN user_locations AS u ON r.user_id = u.id</span>
<span class="s2">    WHERE r.rank &lt;= 10</span>
<span class="s2">  "</span>
<span class="p">}</span>
</code></pre></div>



This query does several things:

1. It creates a temporary table (`referred_users`) of users who have referred other users who have logged in within the past 24 hours, along with a count of such referrals.

2. It ranks these users by the number of such referrals (`ranked_users`).

3. It retrieves the most recent location of each user (`user_locations`).

4. Finally, it joins the location information with the ranked users and selects the top 10 referrers by the number of referred logins. 

Note: This query assumes that the latest location is stored for each user in the `locations` table. If there are multiple locations for a user, the query may need modification. If the database is based on PostgreSQL, for instance, the locations table could be filtered using the `DISTINCT ON (user_id)` clause to ensure that the most recent location is retrieved for each user. Similarly, MySQL could use a nested subquery to achieve the same. This is just an important aspect to consider based on how your database manages the data.
</blockquote>

<h2>Extracting the response</h2>
<p>The response is a JSON object with a key <code>SQL</code> and a value of an SQL query.  You can extract the SQL query from the JSON object and run it against your database to get the answer to your question.</p>
<p>As you can see in the example above, GPT-4 may return more than the JSON format we requested.  We can look for the first '{' and last '}' characters, and attempt to parse JSON with that string.  If it works, great, if not, we can re-ask GPT-4 the question again with a slightly different phrasing to see if it will answer more accurately.<sup id="sf-secure-use-of-gpt-apis-via-metadata-analysis-1-back"><a href="#sf-secure-use-of-gpt-apis-via-metadata-analysis-1" class="simple-footnote" title="There are a number of methods to more accurately extract machine-readable data from GPT-4's responses.  The best methods continue to be researched and developed, and are out of scope for this article.">1</a></sup></p>
<p>Once the data is extracted, we can run it against our database to get the answer to our question.  Cool, right?</p>
<h2>YOU JUST LET GPT-4 ACCESS MY DATABASE?!</h2>
<p>You didn't think we were ending this there.  Of course we're not going to let GPT-4 access your database.  That would be crazy.  We're going to let GPT-4 access a copy of your database, and we're going to make sure that it can't access the original database.  We're also going to only let it access a subset of the original database based on the permissions of the user requesting the data.</p>
<h2>How to Limit Database Access</h2>
<p>There are a couple of mechanisms for limiting database access.  There are a variety of ways to do this that are substantially more efficient, but we're going to focus on the simplest way to do it: Building a completely new sqlite database with a subset of the data.</p>
<h3>Building a New Database</h3>
<p>The first step is to build a new sqlite database with a subset of the data.  This is accomplished by running a series of SQL queries against the original database, and inserting the results into the new database.</p>
<p>Other options do exist, but I am not an expert in various SQL databases, and so I don't want to over-promise on the security of those options.  If you are an expert in SQL databases, you can probably come up with a better way to do this.</p>
<p>So for now, lets walk through the steps to build a new sqlite database with a subset of the data.</p>
<ol>
<li>Create a new, temporary sqlite database, just for this purpose.</li>
<li>Create a new table in the temporary database for each table in the original database.</li>
<li>For each table in the original database, run a query to select the data you want to include in the new database, and insert it into the new table.</li>
</ol>
<p>You can begin this process as soon as you know that you will be asking GPT-4 a question about your database.  You can even do it in the background, so that the database is ready when you need it.  For some larger databases, I am currently regenerating the database every 24 hours, overnight, so that it is ready for the next day.</p>
<p>Updates to the original database will not be reflected in the new database, so you may want may want to mention in your response that the data is only accurate as of a certain timestamp.</p><ol class="simple-footnotes"><li id="sf-secure-use-of-gpt-apis-via-metadata-analysis-1">There are a number of methods to more accurately extract machine-readable data from GPT-4's responses.  The best methods continue to be researched and developed, and are out of scope for this article. <a href="#sf-secure-use-of-gpt-apis-via-metadata-analysis-1-back" class="simple-footnote-back">â©</a></li></ol>
</div>
      <hr class="horizontal-rule-nth-1">
      <div class="markdownBody" id="footer">
          <p class="outro">Figure out what you want. Try to make it happen. Enjoy what you can. Reprioritize regularly.</p>
          <p class="right"> &copy; 2023-<span id="spanYear"></span></p>
      </div>
    </article>
    <div id="footer-decoration-container">
      <a rel="home me contents" title="Bitshard.net homepage" class="footer-logo" href="/index">â</a>
    </div>
  </main>
</body>
</html>